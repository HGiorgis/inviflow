{% extends 'base.html' %} {% block content %}
<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-5">
  <div>
    <div class="d-flex align-items-center gap-3 mb-2">
      <span class="web3-badge">
        <i class="fas fa-id-card"></i>
        Profile Information
      </span>
      <span class="web3-badge">
        <i class="fas fa-shield-alt"></i>
        Verified Account
      </span>
    </div>
    <h1 class="display-6 fw-bold mb-2">My Profile</h1>
    <p class="text-secondary">
      Manage your personal information and preferences
    </p>
  </div>
</div>

<div class="row g-4">
  <!-- Profile Summary Card -->
  <div class="col-md-4">
    <div class="card">
      <div class="card-body text-center p-4">
        <!-- Profile Avatar -->
        <div class="position-relative d-inline-block mb-4">
          <div class="profile-avatar mx-auto">
            <i
              class="fas fa-user-circle fa-5x"
              style="color: var(--primary)"
            ></i>
          </div>
          <button
            class="btn btn-sm btn-primary position-absolute bottom-0 end-0 rounded-circle p-2"
            style="width: 36px; height: 36px"
            onclick="document.getElementById('avatarInput').click()"
          >
            <i class="fas fa-camera"></i>
          </button>
          <input
            type="file"
            id="avatarInput"
            style="display: none"
            accept="image/*"
          />
        </div>

        <!-- User Info -->
        <h4 class="fw-bold mb-1">
          {{ user.get_full_name|default:user.username }}
        </h4>
        <p class="text-secondary mb-3">{{ user.email }}</p>

        <!-- Member Badge -->
        <div class="web3-badge d-inline-flex align-items-center gap-2 mb-4">
          <i class="fas fa-calendar-check"></i>
          Member since {{ user.date_joined|date:"M Y" }}
        </div>

        <!-- Stats -->
        <div class="row g-3">
          <div class="col-6">
            <div
              class="stat-mini-card p-3 rounded-3"
              style="background: var(--gray-1)"
            >
              <div class="h5 fw-bold mb-1">
                {{ total_deposits|default:"0" }}
              </div>
              <small class="text-secondary">Deposits</small>
            </div>
          </div>
          <div class="col-6">
            <div
              class="stat-mini-card p-3 rounded-3"
              style="background: var(--gray-1)"
            >
              <div class="h5 fw-bold mb-1">
                ${{ total_invested|default:"0"|floatformat:2 }}
              </div>
              <small class="text-secondary">Invested</small>
            </div>
          </div>
        </div>

        <!-- Last Login -->
        <div class="mt-3 pt-3 border-top">
          <small class="text-secondary">
            <i class="fas fa-clock me-1"></i>
            Last login: {{ user.last_login|date:"M d, Y H:i" }}
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Profile Form -->
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <i class="fas fa-edit me-2" style="color: var(--primary)"></i>
        Edit Profile
      </div>
      <div class="card-body p-4">
        <form method="post" action="{% url 'core:profile' %}">
          {% csrf_token %}

          <!-- Name Fields -->
          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <label class="form-label fw-semibold">First Name</label>
              <div class="input-group">
                <span class="input-group-text bg-transparent border-end-0">
                  <i class="fas fa-user" style="color: var(--primary)"></i>
                </span>
                <input
                  type="text"
                  name="first_name"
                  class="form-control border-start-0"
                  value="{{ user.first_name }}"
                  placeholder="Enter first name"
                />
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Last Name</label>
              <div class="input-group">
                <span class="input-group-text bg-transparent border-end-0">
                  <i class="fas fa-user" style="color: var(--primary)"></i>
                </span>
                <input
                  type="text"
                  name="last_name"
                  class="form-control border-start-0"
                  value="{{ user.last_name }}"
                  placeholder="Enter last name"
                />
              </div>
            </div>
          </div>

          <!-- Email (Read Only) -->
          <div class="mb-4">
            <label class="form-label fw-semibold">Email Address</label>
            <div class="input-group">
              <span class="input-group-text bg-transparent border-end-0">
                <i class="fas fa-envelope" style="color: var(--primary)"></i>
              </span>
              <input
                type="email"
                class="form-control border-start-0"
                value="{{ user.email }}"
                readonly
              />
              <span class="input-group-text bg-transparent">
                <i class="fas fa-check-circle text-success"></i>
              </span>
            </div>
            <small class="text-secondary mt-1 d-block">
              <i class="fas fa-info-circle me-1"></i>
              Email cannot be changed
            </small>
          </div>

          <!-- Phone -->
          <div class="mb-4">
            <label class="form-label fw-semibold">Phone Number</label>
            <div class="input-group">
              <span class="input-group-text bg-transparent border-end-0">
                <i class="fas fa-phone" style="color: var(--primary)"></i>
              </span>
              <input
                type="tel"
                name="phone"
                class="form-control border-start-0"
                value="{{ profile.phone|default:'' }}"
                placeholder="+1 (555) 000-0000"
              />
            </div>
          </div>

          <!-- Company -->
          <div class="mb-4">
            <label class="form-label fw-semibold">Company</label>
            <div class="input-group">
              <span class="input-group-text bg-transparent border-end-0">
                <i class="fas fa-building" style="color: var(--primary)"></i>
              </span>
              <input
                type="text"
                name="company"
                class="form-control border-start-0"
                value="{{ profile.company|default:'' }}"
                placeholder="Enter company name"
              />
            </div>
          </div>

          <!-- Address -->
          <div class="mb-4">
            <label class="form-label fw-semibold">Address</label>
            <textarea
              name="address"
              class="form-control"
              rows="3"
              placeholder="Enter your address"
            >
{{ profile.address|default:'' }}</textarea
            >
          </div>

          <!-- Form Actions -->
          <div class="d-flex gap-3">
            <button type="submit" class="btn btn-primary px-4">
              <i class="fas fa-save me-2"></i>
              Save Changes
            </button>
            <button type="reset" class="btn btn-outline-secondary px-4">
              <i class="fas fa-undo me-2"></i>
              Reset
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Security Section -->
    <div class="card mt-4">
      <div class="card-header">
        <i class="fas fa-shield-alt me-2" style="color: var(--primary)"></i>
        Security Settings
      </div>
      <div class="card-body p-4">
        <div class="row g-4">
          <!-- Password Change -->
          <div class="col-md-6">
            <div
              class="security-item p-3 rounded-3"
              style="background: var(--gray-1)"
            >
              <div class="d-flex align-items-center gap-3 mb-3">
                <div class="security-icon">
                  <div
                    class="rounded-circle p-2"
                    style="
                      background: rgba(0, 82, 255, 0.1);
                      width: 40px;
                      height: 40px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                    "
                  >
                    <i class="fas fa-key" style="color: var(--primary)"></i>
                  </div>
                </div>
                <div>
                  <h6 class="fw-semibold mb-1">Password</h6>
                  <small class="text-secondary"
                    >Last changed: 30 days ago</small
                  >
                </div>
              </div>
              <a
                href="{% url 'password_change' %}"
                class="btn btn-outline-primary w-100"
              >
                <i class="fas fa-edit me-2"></i>
                Change Password
              </a>
            </div>
          </div>

          <!-- Two Factor Authentication -->
          <div class="col-md-6">
            <div
              class="security-item p-3 rounded-3"
              style="background: var(--gray-1)"
            >
              <div class="d-flex align-items-center gap-3 mb-3">
                <div class="security-icon">
                  <div
                    class="rounded-circle p-2"
                    style="
                      background: rgba(0, 211, 143, 0.1);
                      width: 40px;
                      height: 40px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                    "
                  >
                    <i
                      class="fas fa-mobile-alt"
                      style="color: var(--success)"
                    ></i>
                  </div>
                </div>
                <div>
                  <h6 class="fw-semibold mb-1">Two-Factor Auth</h6>
                  <small class="text-secondary">
                    <span class="badge badge-success">Enabled</span>
                  </small>
                </div>
              </div>
              <button
                class="btn btn-outline-success w-100"
                onclick="showToast('2FA settings coming soon')"
              >
                <i class="fas fa-cog me-2"></i>
                Configure
              </button>
            </div>
          </div>

          <!-- API Keys -->
          <div class="col-md-6">
            <div
              class="security-item p-3 rounded-3"
              style="background: var(--gray-1)"
            >
              <div class="d-flex align-items-center gap-3 mb-3">
                <div class="security-icon">
                  <div
                    class="rounded-circle p-2"
                    style="
                      background: rgba(255, 184, 0, 0.1);
                      width: 40px;
                      height: 40px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                    "
                  >
                    <i class="fas fa-key" style="color: var(--warning)"></i>
                  </div>
                </div>
                <div>
                  <h6 class="fw-semibold mb-1">API Keys</h6>
                  <small class="text-secondary">Manage API access</small>
                </div>
              </div>
              <button
                class="btn btn-outline-warning w-100"
                onclick="showToast('API management coming soon')"
              >
                <i class="fas fa-plug me-2"></i>
                Manage Keys
              </button>
            </div>
          </div>

          <!-- Sessions -->
          <div class="col-md-6">
            <div
              class="security-item p-3 rounded-3"
              style="background: var(--gray-1)"
            >
              <div class="d-flex align-items-center gap-3 mb-3">
                <div class="security-icon">
                  <div
                    class="rounded-circle p-2"
                    style="
                      background: rgba(108, 92, 231, 0.1);
                      width: 40px;
                      height: 40px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                    "
                  >
                    <i
                      class="fas fa-laptop"
                      style="color: var(--secondary)"
                    ></i>
                  </div>
                </div>
                <div>
                  <h6 class="fw-semibold mb-1">Active Sessions</h6>
                  <small class="text-secondary">2 active sessions</small>
                </div>
              </div>
              <button
                class="btn btn-outline-secondary w-100"
                onclick="showToast('Session management coming soon')"
              >
                <i class="fas fa-list me-2"></i>
                View All
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Recent Activity -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <i class="fas fa-history me-2" style="color: var(--primary)"></i>
        Recent Activity
      </div>
      <div class="card-body p-0">
        <div class="activity-timeline">
          {% for deposit in recent_deposits|slice:":5" %}
          <div
            class="activity-item d-flex align-items-center gap-3 p-3 border-bottom"
          >
            <div class="activity-icon">
              <div
                class="rounded-circle p-2"
                style="
                  background: var(--primary-light);
                  width: 36px;
                  height: 36px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                "
              >
                <i class="fas fa-arrow-down" style="color: var(--primary)"></i>
              </div>
            </div>
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between">
                <h6 class="fw-semibold mb-1">
                  Deposit of ${{ deposit.amount|floatformat:2 }} USDC
                </h6>
                <small class="text-secondary"
                  >{{ deposit.created_at|timesince }} ago</small
                >
              </div>
              <div>
                {% if deposit.status == 'completed' %}
                <span class="badge badge-success">Completed</span>
                {% elif deposit.status == 'pending' %}
                <span class="badge badge-warning">Pending</span>
                {% else %}
                <span class="badge badge-danger">Failed</span>
                {% endif %}
              </div>
            </div>
          </div>
          {% empty %}
          <div class="text-center py-5">
            <i
              class="fas fa-history fa-3x mb-3"
              style="color: var(--gray-4)"
            ></i>
            <p class="text-secondary">No recent activity</p>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

{% block extra_js %}
<script>
  // Avatar upload preview
  document
    .getElementById("avatarInput")
    .addEventListener("change", function (e) {
      if (this.files && this.files[0]) {
        const reader = new FileReader();
        reader.onload = function (e) {
          showToast("Profile picture updated successfully!");
        };
        reader.readAsDataURL(this.files[0]);
      }
    });

  // Form validation
  document.querySelector("form").addEventListener("submit", function (e) {
    e.preventDefault();
    showToast("Profile updated successfully!");
    setTimeout(() => {
      this.submit();
    }, 1500);
  });
</script>

<style>
  /* Profile page specific styles */
  .profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 60px;
    background: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
    border: 3px solid white;
    box-shadow: var(--shadow-md);
  }

  .profile-avatar i {
    font-size: 4rem;
  }

  .stat-mini-card {
    transition: var(--transition);
  }

  .stat-mini-card:hover {
    transform: translateY(-2px);
    background: var(--primary-light) !important;
  }

  .security-item {
    transition: var(--transition);
  }

  .security-item:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .activity-item {
    transition: var(--transition);
  }

  .activity-item:hover {
    background: var(--gray-1);
    padding-left: 1.5rem !important;
  }

  .border-bottom {
    border-bottom-color: var(--gray-3) !important;
  }

  .input-group-text {
    border: 1px solid var(--gray-3);
    color: var(--text-secondary);
  }

  .form-control {
    border: 1px solid var(--gray-3);
  }

  .form-control:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 82, 255, 0.1);
  }

  textarea.form-control {
    min-height: 100px;
  }

  .web3-badge {
    background: var(--gray-2);
    color: var(--text-secondary);
    padding: 0.4rem 1rem;
    border-radius: 100px;
    font-size: 0.85rem;
    font-weight: 500;
  }
</style>
{% endblock %} {% endblock %}
