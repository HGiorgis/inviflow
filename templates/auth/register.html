{% extends 'base.html' %} {% block content_unauth %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <!-- Web3 Badge -->
      <div class="text-center mb-4">
        <span class="web3-badge">
          <i class="fas fa-rocket"></i>
          Join Now
        </span>
      </div>

      <!-- Register Card -->
      <div class="card border-0 shadow-lg">
        <div class="card-body p-5">
          <!-- Header -->
          <div class="text-center mb-4">
            <div class="feature-icon mx-auto mb-3">
              <i class="fas fa-user-plus fa-2x"></i>
            </div>
            <h2 class="fw-bold mb-2">Create Account</h2>
            <p class="text-secondary">Start your investment journey today</p>
          </div>

          <!-- Progress Bar -->
          <div class="progress mb-4" style="height: 6px">
            <div
              class="progress-bar bg-primary"
              role="progressbar"
              style="width: 33%"
              id="formProgress"
            ></div>
          </div>

          <!-- Register Form -->
          <form method="post" id="registerForm">
            {% csrf_token %} {% if form.errors %}
            <div
              class="alert alert-danger d-flex align-items-center mb-4"
              role="alert"
            >
              <i class="fas fa-exclamation-circle me-2"></i>
              <div>
                <strong>Please correct the following errors:</strong>
                <ul class="mb-0 mt-2">
                  {% for field, errors in form.errors.items %}
                  <li>{{ field }}: {{ errors|join:", " }}</li>
                  {% endfor %}
                </ul>
              </div>
            </div>
            {% endif %}

            <!-- Step 1: Personal Info -->
            <div class="form-step" id="step1">
              <h5 class="mb-3">Personal Information</h5>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="id_first_name" class="form-label fw-semibold">
                    <i
                      class="fas fa-user me-2"
                      style="color: var(--primary)"
                    ></i>
                    First Name
                  </label>
                  <input
                    type="text"
                    name="first_name"
                    class="form-control form-control-lg"
                    id="id_first_name"
                    value="{{ form.first_name.value|default:'' }}"
                    placeholder="John"
                    required
                  />
                </div>

                <div class="col-md-6 mb-3">
                  <label for="id_last_name" class="form-label fw-semibold">
                    <i
                      class="fas fa-user me-2"
                      style="color: var(--primary)"
                    ></i>
                    Last Name
                  </label>
                  <input
                    type="text"
                    name="last_name"
                    class="form-control form-control-lg"
                    id="id_last_name"
                    value="{{ form.last_name.value|default:'' }}"
                    placeholder="Doe"
                    required
                  />
                </div>
              </div>

              <div class="mb-3">
                <label for="id_email" class="form-label fw-semibold">
                  <i
                    class="fas fa-envelope me-2"
                    style="color: var(--primary)"
                  ></i>
                  Email Address
                </label>
                <input
                  type="email"
                  name="email"
                  class="form-control form-control-lg"
                  id="id_email"
                  value="{{ form.email.value|default:'' }}"
                  placeholder="john@example.com"
                  required
                />
                <small class="text-secondary mt-1 d-block">
                  We'll never share your email with anyone else
                </small>
              </div>
            </div>

            <!-- Step 2: Account Setup -->
            <div class="form-step" id="step2" style="display: none">
              <h5 class="mb-3">Account Setup</h5>

              <div class="mb-3">
                <label for="id_username" class="form-label fw-semibold">
                  <i class="fas fa-at me-2" style="color: var(--primary)"></i>
                  Username
                </label>
                <input
                  type="text"
                  name="username"
                  class="form-control form-control-lg"
                  id="id_username"
                  value="{{ form.username.value|default:'' }}"
                  placeholder="johndoe"
                  required
                />
                <small class="text-secondary mt-1 d-block">
                  150 characters or fewer. Letters, digits and @/./+/-/_ only.
                </small>
              </div>
            </div>

            <!-- Step 3: Security -->
            <div class="form-step" id="step3" style="display: none">
              <h5 class="mb-3">Security</h5>

              <div class="mb-3">
                <label for="id_password1" class="form-label fw-semibold">
                  <i class="fas fa-lock me-2" style="color: var(--primary)"></i>
                  Password
                </label>
                <div class="input-group">
                  <input
                    type="password"
                    name="password1"
                    class="form-control form-control-lg"
                    id="id_password1"
                    placeholder="Create a strong password"
                    required
                  />
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    onclick="togglePassword('password1')"
                  >
                    <i class="fas fa-eye" id="togglePassword1Icon"></i>
                  </button>
                </div>
                <div class="password-strength mt-2">
                  <div class="progress" style="height: 4px">
                    <div
                      class="progress-bar"
                      id="passwordStrength"
                      style="width: 0%"
                    ></div>
                  </div>
                  <small class="text-secondary mt-1 d-block">
                    Use at least 8 characters with letters, numbers & symbols
                  </small>
                </div>
              </div>

              <div class="mb-3">
                <label for="id_password2" class="form-label fw-semibold">
                  <i
                    class="fas fa-check-circle me-2"
                    style="color: var(--primary)"
                  ></i>
                  Confirm Password
                </label>
                <div class="input-group">
                  <input
                    type="password"
                    name="password2"
                    class="form-control form-control-lg"
                    id="id_password2"
                    placeholder="Re-enter your password"
                    required
                  />
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    onclick="togglePassword('password2')"
                  >
                    <i class="fas fa-eye" id="togglePassword2Icon"></i>
                  </button>
                </div>
                <div id="passwordMatch" class="mt-1 small"></div>
              </div>

              <!-- Terms & Conditions -->
              <div class="form-check mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="terms"
                  required
                />
                <label class="form-check-label small" for="terms">
                  I agree to the
                  <a href="#" class="text-primary">Terms of Service</a> and
                  <a href="#" class="text-primary">Privacy Policy</a>
                </label>
              </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="d-flex justify-content-between mt-4">
              <button
                type="button"
                class="btn btn-outline-secondary"
                id="prevBtn"
                onclick="changeStep(-1)"
                style="display: none"
              >
                <i class="fas fa-arrow-left me-2"></i>
                Previous
              </button>
              <button
                type="button"
                class="btn btn-primary"
                id="nextBtn"
                onclick="changeStep(1)"
              >
                Next Step
                <i class="fas fa-arrow-right ms-2"></i>
              </button>
              <button
                type="submit"
                class="btn btn-success"
                id="submitBtn"
                style="display: none"
              >
                <i class="fas fa-check-circle me-2"></i>
                Create Account
              </button>
            </div>
          </form>

          <!-- Alternative Registration -->
          <div class="position-relative my-4">
            <hr class="text-secondary" />
            <span
              class="position-absolute top-50 start-50 translate-middle px-3 bg-white text-secondary small"
            >
              or register with
            </span>
          </div>

          <div class="d-flex gap-2">
            <button
              class="btn btn-outline-secondary flex-grow-1 py-2"
              onclick="connectGoogle()"
            >
              <i class="fab fa-google me-2"></i>
              Google
            </button>
            <button
              class="btn btn-outline-secondary flex-grow-1 py-2"
              onclick="connectGithub()"
            >
              <i class="fab fa-github me-2"></i>
              GitHub
            </button>
          </div>

          <!-- Login Link -->
          <p class="text-center text-secondary mb-0 mt-4">
            Already have an account?
            <a
              href="{% url 'login' %}"
              class="text-primary text-decoration-none fw-semibold"
            >
              Sign In <i class="fas fa-arrow-right ms-1"></i>
            </a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

{% block extra_js %}
<script>
  let currentStep = 1;
  const totalSteps = 3;

  // Update progress bar
  function updateProgress() {
    const progress = (currentStep / totalSteps) * 100;
    document.getElementById("formProgress").style.width = progress + "%";
  }

  // Change step
  function changeStep(direction) {
    const currentStepEl = document.getElementById(`step${currentStep}`);
    currentStepEl.style.display = "none";

    currentStep += direction;

    const nextStepEl = document.getElementById(`step${currentStep}`);
    nextStepEl.style.display = "block";

    // Update buttons
    document.getElementById("prevBtn").style.display =
      currentStep === 1 ? "none" : "inline-block";

    if (currentStep === totalSteps) {
      document.getElementById("nextBtn").style.display = "none";
      document.getElementById("submitBtn").style.display = "inline-block";
    } else {
      document.getElementById("nextBtn").style.display = "inline-block";
      document.getElementById("submitBtn").style.display = "none";
    }

    updateProgress();
  }

  // Password strength checker
  document
    .getElementById("id_password1")
    .addEventListener("input", function (e) {
      const password = e.target.value;
      let strength = 0;

      if (password.length >= 8) strength += 25;
      if (password.match(/[a-z]+/)) strength += 25;
      if (password.match(/[A-Z]+/)) strength += 25;
      if (password.match(/[0-9]+/)) strength += 25;

      document.getElementById("passwordStrength").style.width = strength + "%";

      if (strength < 50) {
        document.getElementById("passwordStrength").className =
          "progress-bar bg-danger";
      } else if (strength < 75) {
        document.getElementById("passwordStrength").className =
          "progress-bar bg-warning";
      } else {
        document.getElementById("passwordStrength").className =
          "progress-bar bg-success";
      }
    });

  // Password match checker
  document
    .getElementById("id_password2")
    .addEventListener("input", function (e) {
      const password1 = document.getElementById("id_password1").value;
      const password2 = e.target.value;
      const matchDiv = document.getElementById("passwordMatch");

      if (password2.length > 0) {
        if (password1 === password2) {
          matchDiv.innerHTML =
            '<span class="text-success"><i class="fas fa-check-circle"></i> Passwords match</span>';
        } else {
          matchDiv.innerHTML =
            '<span class="text-danger"><i class="fas fa-times-circle"></i> Passwords do not match</span>';
        }
      } else {
        matchDiv.innerHTML = "";
      }
    });

  // Toggle password visibility
  function togglePassword(fieldId) {
    const passwordInput = document.getElementById(`id_${fieldId}`);
    const icon = document.getElementById(
      `togglePassword${fieldId.charAt(fieldId.length - 1).toUpperCase()}Icon`,
    );

    if (passwordInput.type === "password") {
      passwordInput.type = "text";
      icon.classList.remove("fa-eye");
      icon.classList.add("fa-eye-slash");
    } else {
      passwordInput.type = "password";
      icon.classList.remove("fa-eye-slash");
      icon.classList.add("fa-eye");
    }
  }

  // Social connections
  function connectGoogle() {
    showToast("Connecting to Google...", "info");
  }

  function connectWallet() {
    showToast("Connecting Web3 wallet...", "info");
  }

  function connectGithub() {
    showToast("Connecting to GitHub...", "info");
  }

  // Form validation before submit
  document
    .getElementById("registerForm")
    .addEventListener("submit", function (e) {
      if (!document.getElementById("terms").checked) {
        e.preventDefault();
        showToast("Please accept the Terms of Service", "error");
      }
    });

  // Add floating effect
  document.addEventListener("DOMContentLoaded", function () {
    const card = document.querySelector(".card");
    card.addEventListener("mouseenter", function () {
      this.style.transform = "translateY(-5px)";
      this.style.boxShadow = "var(--shadow-hover)";
    });

    card.addEventListener("mouseleave", function () {
      this.style.transform = "translateY(0)";
      this.style.boxShadow = "var(--shadow-lg)";
    });
  });
</script>

<style>
  /* Additional styles for register page */
  .feature-icon {
    width: 70px;
    height: 70px;
    background: var(--primary-light);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .feature-icon i {
    color: var(--primary);
    font-size: 2rem;
  }

  .form-control-lg {
    padding: 0.75rem 1rem;
    font-size: 1rem;
    border-radius: var(--border-radius-md);
    border: 1.5px solid var(--gray-3);
    transition: var(--transition);
  }

  .form-control-lg:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 82, 255, 0.1);
  }

  .progress {
    background-color: var(--gray-2);
    border-radius: 100px;
  }

  .progress-bar {
    border-radius: 100px;
    transition: width 0.3s ease;
  }

  .input-group .btn-outline-secondary {
    border: 1.5px solid var(--gray-3);
    border-left: none;
  }

  .input-group .btn-outline-secondary:hover {
    background: var(--gray-2);
    color: var(--primary);
    border-color: var(--primary);
  }

  .web3-badge {
    background: var(--gray-2);
    color: var(--text-secondary);
    padding: 0.4rem 1rem;
    border-radius: 100px;
    font-size: 0.85rem;
    font-weight: 500;
  }

  .form-step {
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateX(10px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>
{% endblock %} {% endblock %}
